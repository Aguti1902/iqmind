// ============================================
// PLANTILLAS DE EMAIL MULTIIDIOMA PARA N8N
// ============================================
// Usar este c√≥digo en nodos JavaScript de n8n

function getEmailTemplate(tipo, idioma, datos) {
  // Fallback a ingl√©s si el idioma no est√° soportado
  const lang = ['es', 'en', 'fr', 'de', 'it', 'pt'].includes(idioma) ? idioma : 'en';
  
  const templates = {
    // ====================================
    // REEMBOLSO APROBADO
    // ====================================
    reembolso_aprobado: {
      es: {
        subject: 'Reembolso Procesado - MindMetric',
        title: '‚úÖ Reembolso Procesado',
        greeting: 'Hola,',
        success: '‚úì Tu reembolso ha sido procesado exitosamente',
        details_title: 'Detalles del reembolso:',
        amount: 'Monto:',
        method: 'M√©todo:',
        time: 'Tiempo estimado:',
        time_value: '3-5 d√≠as h√°biles',
        payment_method: 'Pago inicial',
        subscription_method: 'Suscripci√≥n',
        info: 'El reembolso se procesar√° al mismo m√©todo de pago que utilizaste originalmente.',
        questions: 'Si tienes alguna pregunta, no dudes en contactarnos.',
        thanks: 'Gracias por tu comprensi√≥n.',
        signature: 'Atentamente,<br><strong>Equipo de MindMetric</strong>',
        footer: 'Este es un email autom√°tico generado por nuestro sistema de IA.'
      },
      en: {
        subject: 'Refund Processed - MindMetric',
        title: '‚úÖ Refund Processed',
        greeting: 'Hello,',
        success: '‚úì Your refund has been processed successfully',
        details_title: 'Refund details:',
        amount: 'Amount:',
        method: 'Method:',
        time: 'Estimated time:',
        time_value: '3-5 business days',
        payment_method: 'Initial payment',
        subscription_method: 'Subscription',
        info: 'The refund will be processed to the same payment method you originally used.',
        questions: 'If you have any questions, please don\'t hesitate to contact us.',
        thanks: 'Thank you for your understanding.',
        signature: 'Best regards,<br><strong>MindMetric Team</strong>',
        footer: 'This is an automated email generated by our AI system.'
      },
      fr: {
        subject: 'Remboursement Trait√© - MindMetric',
        title: '‚úÖ Remboursement Trait√©',
        greeting: 'Bonjour,',
        success: '‚úì Votre remboursement a √©t√© trait√© avec succ√®s',
        details_title: 'D√©tails du remboursement:',
        amount: 'Montant:',
        method: 'M√©thode:',
        time: 'D√©lai estim√©:',
        time_value: '3-5 jours ouvrables',
        payment_method: 'Paiement initial',
        subscription_method: 'Abonnement',
        info: 'Le remboursement sera trait√© vers la m√™me m√©thode de paiement que vous avez utilis√©e initialement.',
        questions: 'Si vous avez des questions, n\'h√©sitez pas √† nous contacter.',
        thanks: 'Merci de votre compr√©hension.',
        signature: 'Cordialement,<br><strong>√âquipe MindMetric</strong>',
        footer: 'Ceci est un email automatique g√©n√©r√© par notre syst√®me IA.'
      },
      de: {
        subject: 'R√ºckerstattung Bearbeitet - MindMetric',
        title: '‚úÖ R√ºckerstattung Bearbeitet',
        greeting: 'Hallo,',
        success: '‚úì Ihre R√ºckerstattung wurde erfolgreich bearbeitet',
        details_title: 'Details zur R√ºckerstattung:',
        amount: 'Betrag:',
        method: 'Methode:',
        time: 'Gesch√§tzte Zeit:',
        time_value: '3-5 Werktage',
        payment_method: 'Erstzahlung',
        subscription_method: 'Abonnement',
        info: 'Die R√ºckerstattung wird auf dieselbe Zahlungsmethode erfolgen, die Sie urspr√ºnglich verwendet haben.',
        questions: 'Wenn Sie Fragen haben, z√∂gern Sie nicht, uns zu kontaktieren.',
        thanks: 'Vielen Dank f√ºr Ihr Verst√§ndnis.',
        signature: 'Mit freundlichen Gr√º√üen,<br><strong>MindMetric Team</strong>',
        footer: 'Dies ist eine automatische E-Mail, die von unserem KI-System generiert wurde.'
      },
      it: {
        subject: 'Rimborso Elaborato - MindMetric',
        title: '‚úÖ Rimborso Elaborato',
        greeting: 'Ciao,',
        success: '‚úì Il tuo rimborso √® stato elaborato con successo',
        details_title: 'Dettagli del rimborso:',
        amount: 'Importo:',
        method: 'Metodo:',
        time: 'Tempo stimato:',
        time_value: '3-5 giorni lavorativi',
        payment_method: 'Pagamento iniziale',
        subscription_method: 'Abbonamento',
        info: 'Il rimborso sar√† elaborato con lo stesso metodo di pagamento che hai utilizzato originariamente.',
        questions: 'Se hai domande, non esitare a contattarci.',
        thanks: 'Grazie per la tua comprensione.',
        signature: 'Cordiali saluti,<br><strong>Team MindMetric</strong>',
        footer: 'Questa √® un\'email automatica generata dal nostro sistema IA.'
      },
      pt: {
        subject: 'Reembolso Processado - MindMetric',
        title: '‚úÖ Reembolso Processado',
        greeting: 'Ol√°,',
        success: '‚úì Seu reembolso foi processado com sucesso',
        details_title: 'Detalhes do reembolso:',
        amount: 'Valor:',
        method: 'M√©todo:',
        time: 'Tempo estimado:',
        time_value: '3-5 dias √∫teis',
        payment_method: 'Pagamento inicial',
        subscription_method: 'Assinatura',
        info: 'O reembolso ser√° processado para o mesmo m√©todo de pagamento que voc√™ utilizou originalmente.',
        questions: 'Se tiver alguma d√∫vida, n√£o hesite em nos contatar.',
        thanks: 'Obrigado pela sua compreens√£o.',
        signature: 'Atenciosamente,<br><strong>Equipe MindMetric</strong>',
        footer: 'Este √© um email autom√°tico gerado pelo nosso sistema de IA.'
      }
    },
    
    // ====================================
    // CANCELACI√ìN CONFIRMADA
    // ====================================
    cancelacion: {
      es: {
        subject: '‚úÖ Suscripci√≥n Cancelada - MindMetric',
        title: '‚úÖ Suscripci√≥n Cancelada',
        greeting: 'Hola,',
        success: '‚úì Tu suscripci√≥n ha sido cancelada exitosamente',
        info_title: 'Informaci√≥n importante:',
        info_1: 'No habr√° m√°s cargos a tu tarjeta',
        info_2: 'Puedes seguir usando el servicio hasta el final del per√≠odo actual',
        info_3: 'Tu cuenta permanecer√° activa (sin acceso premium)',
        reactivate: 'Si en el futuro deseas reactivar tu suscripci√≥n, estaremos encantados de ayudarte.',
        goodbye: '¬°Gracias por haber sido parte de MindMetric!',
        signature: 'Atentamente,<br><strong>Equipo de MindMetric</strong>',
        footer: 'Este es un email autom√°tico generado por nuestro sistema de IA.'
      },
      en: {
        subject: '‚úÖ Subscription Cancelled - MindMetric',
        title: '‚úÖ Subscription Cancelled',
        greeting: 'Hello,',
        success: '‚úì Your subscription has been cancelled successfully',
        info_title: 'Important information:',
        info_1: 'There will be no more charges to your card',
        info_2: 'You can continue using the service until the end of your current period',
        info_3: 'Your account will remain active (without premium access)',
        reactivate: 'If you wish to reactivate your subscription in the future, we\'ll be happy to help.',
        goodbye: 'Thank you for being part of MindMetric!',
        signature: 'Best regards,<br><strong>MindMetric Team</strong>',
        footer: 'This is an automated email generated by our AI system.'
      },
      fr: {
        subject: '‚úÖ Abonnement Annul√© - MindMetric',
        title: '‚úÖ Abonnement Annul√©',
        greeting: 'Bonjour,',
        success: '‚úì Votre abonnement a √©t√© annul√© avec succ√®s',
        info_title: 'Information importante:',
        info_1: 'Il n\'y aura plus de frais sur votre carte',
        info_2: 'Vous pouvez continuer √† utiliser le service jusqu\'√† la fin de votre p√©riode actuelle',
        info_3: 'Votre compte restera actif (sans acc√®s premium)',
        reactivate: 'Si vous souhaitez r√©activer votre abonnement √† l\'avenir, nous serons heureux de vous aider.',
        goodbye: 'Merci d\'avoir fait partie de MindMetric!',
        signature: 'Cordialement,<br><strong>√âquipe MindMetric</strong>',
        footer: 'Ceci est un email automatique g√©n√©r√© par notre syst√®me IA.'
      },
      de: {
        subject: '‚úÖ Abonnement Gek√ºndigt - MindMetric',
        title: '‚úÖ Abonnement Gek√ºndigt',
        greeting: 'Hallo,',
        success: '‚úì Ihr Abonnement wurde erfolgreich gek√ºndigt',
        info_title: 'Wichtige Information:',
        info_1: 'Es werden keine weiteren Geb√ºhren von Ihrer Karte abgebucht',
        info_2: 'Sie k√∂nnen den Service bis zum Ende des aktuellen Zeitraums weiter nutzen',
        info_3: 'Ihr Konto bleibt aktiv (ohne Premium-Zugang)',
        reactivate: 'Wenn Sie Ihr Abonnement in Zukunft wieder aktivieren m√∂chten, helfen wir Ihnen gerne.',
        goodbye: 'Vielen Dank, dass Sie Teil von MindMetric waren!',
        signature: 'Mit freundlichen Gr√º√üen,<br><strong>MindMetric Team</strong>',
        footer: 'Dies ist eine automatische E-Mail, die von unserem KI-System generiert wurde.'
      },
      it: {
        subject: '‚úÖ Abbonamento Cancellato - MindMetric',
        title: '‚úÖ Abbonamento Cancellato',
        greeting: 'Ciao,',
        success: '‚úì Il tuo abbonamento √® stato cancellato con successo',
        info_title: 'Informazioni importanti:',
        info_1: 'Non ci saranno pi√π addebiti sulla tua carta',
        info_2: 'Puoi continuare a utilizzare il servizio fino alla fine del periodo attuale',
        info_3: 'Il tuo account rimarr√† attivo (senza accesso premium)',
        reactivate: 'Se in futuro desideri riattivare il tuo abbonamento, saremo felici di aiutarti.',
        goodbye: 'Grazie per essere stato parte di MindMetric!',
        signature: 'Cordiali saluti,<br><strong>Team MindMetric</strong>',
        footer: 'Questa √® un\'email automatica generata dal nostro sistema IA.'
      },
      pt: {
        subject: '‚úÖ Assinatura Cancelada - MindMetric',
        title: '‚úÖ Assinatura Cancelada',
        greeting: 'Ol√°,',
        success: '‚úì Sua assinatura foi cancelada com sucesso',
        info_title: 'Informa√ß√£o importante:',
        info_1: 'N√£o haver√° mais cobran√ßas no seu cart√£o',
        info_2: 'Voc√™ pode continuar usando o servi√ßo at√© o final do per√≠odo atual',
        info_3: 'Sua conta permanecer√° ativa (sem acesso premium)',
        reactivate: 'Se no futuro desejar reativar sua assinatura, teremos prazer em ajudar.',
        goodbye: 'Obrigado por ter sido parte do MindMetric!',
        signature: 'Atenciosamente,<br><strong>Equipe MindMetric</strong>',
        footer: 'Este √© um email autom√°tico gerado pelo nosso sistema de IA.'
      }
    },
    
    // ====================================
    // CLIENTE NO ENCONTRADO
    // ====================================
    no_encontrado: {
      es: {
        subject: 'üîç Informaci√≥n Adicional Requerida - MindMetric',
        title: 'üîç Informaci√≥n Adicional Requerida',
        greeting: 'Hola,',
        not_found: '‚ö†Ô∏è No encontramos tu cuenta con el email: ',
        help: 'Para procesar tu solicitud, necesitamos verificar algunos datos de tu pedido.',
        provide_title: 'üìã Por favor, responde a este correo proporcionando:',
        provide_1: '<strong>Email usado en el pago</strong> (si es diferente)',
        provide_2: '<strong>Fecha aproximada del pago</strong> (d√≠a/mes/a√±o)',
        provide_3: '<strong>Monto del pago</strong> (1‚Ç¨, 9.99‚Ç¨ o 19.99‚Ç¨)',
        provide_4: '<strong>√öltimos 4 d√≠gitos de la tarjeta</strong> usada',
        provide_5: '<strong>Nombre del titular</strong> de la tarjeta (opcional)',
        attach_title: 'üí° Tambi√©n puedes adjuntar:',
        attach_1: 'Captura del recibo de Stripe',
        attach_2: 'Email de confirmaci√≥n de pago',
        attach_3: 'Extracto bancario (ocultando datos sensibles)',
        fast: 'Con esta informaci√≥n podremos localizar tu pedido y procesar tu solicitud r√°pidamente.',
        note: '<strong>Nota:</strong> Si escribiste desde un email diferente al de tu compra, es normal que no te encontremos. Simplemente proporciona el email correcto y te ayudaremos.',
        signature: 'Atentamente,<br><strong>Equipo de MindMetric</strong>',
        footer: 'Responde a este correo con la informaci√≥n solicitada'
      },
      en: {
        subject: 'üîç Additional Information Required - MindMetric',
        title: 'üîç Additional Information Required',
        greeting: 'Hello,',
        not_found: '‚ö†Ô∏è We couldn\'t find your account with the email: ',
        help: 'To process your request, we need to verify some details about your order.',
        provide_title: 'üìã Please reply to this email providing:',
        provide_1: '<strong>Email used for payment</strong> (if different)',
        provide_2: '<strong>Approximate payment date</strong> (day/month/year)',
        provide_3: '<strong>Payment amount</strong> (1‚Ç¨, 9.99‚Ç¨ or 19.99‚Ç¨)',
        provide_4: '<strong>Last 4 digits of the card</strong> used',
        provide_5: '<strong>Cardholder name</strong> (optional)',
        attach_title: 'üí° You can also attach:',
        attach_1: 'Stripe receipt screenshot',
        attach_2: 'Payment confirmation email',
        attach_3: 'Bank statement (hiding sensitive data)',
        fast: 'With this information we can locate your order and process your request quickly.',
        note: '<strong>Note:</strong> If you wrote from a different email than your purchase, it\'s normal we can\'t find you. Simply provide the correct email and we\'ll help you.',
        signature: 'Best regards,<br><strong>MindMetric Team</strong>',
        footer: 'Reply to this email with the requested information'
      },
      fr: {
        subject: 'üîç Informations Suppl√©mentaires Requises - MindMetric',
        title: 'üîç Informations Suppl√©mentaires Requises',
        greeting: 'Bonjour,',
        not_found: '‚ö†Ô∏è Nous n\'avons pas trouv√© votre compte avec l\'email: ',
        help: 'Pour traiter votre demande, nous devons v√©rifier certains d√©tails de votre commande.',
        provide_title: 'üìã Veuillez r√©pondre √† cet email en fournissant:',
        provide_1: '<strong>Email utilis√© pour le paiement</strong> (si diff√©rent)',
        provide_2: '<strong>Date approximative du paiement</strong> (jour/mois/ann√©e)',
        provide_3: '<strong>Montant du paiement</strong> (1‚Ç¨, 9.99‚Ç¨ ou 19.99‚Ç¨)',
        provide_4: '<strong>4 derniers chiffres de la carte</strong> utilis√©e',
        provide_5: '<strong>Nom du titulaire</strong> de la carte (optionnel)',
        attach_title: 'üí° Vous pouvez √©galement joindre:',
        attach_1: 'Capture d\'√©cran du re√ßu Stripe',
        attach_2: 'Email de confirmation de paiement',
        attach_3: 'Relev√© bancaire (en masquant les donn√©es sensibles)',
        fast: 'Avec ces informations, nous pourrons localiser votre commande et traiter votre demande rapidement.',
        note: '<strong>Note:</strong> Si vous avez √©crit depuis un email diff√©rent de celui de votre achat, il est normal que nous ne vous trouvions pas. Fournissez simplement l\'email correct et nous vous aiderons.',
        signature: 'Cordialement,<br><strong>√âquipe MindMetric</strong>',
        footer: 'R√©pondez √† cet email avec les informations demand√©es'
      },
      de: {
        subject: 'üîç Zus√§tzliche Informationen Erforderlich - MindMetric',
        title: 'üîç Zus√§tzliche Informationen Erforderlich',
        greeting: 'Hallo,',
        not_found: '‚ö†Ô∏è Wir konnten Ihr Konto mit der E-Mail nicht finden: ',
        help: 'Um Ihre Anfrage zu bearbeiten, m√ºssen wir einige Details zu Ihrer Bestellung √ºberpr√ºfen.',
        provide_title: 'üìã Bitte antworten Sie auf diese E-Mail mit:',
        provide_1: '<strong>F√ºr die Zahlung verwendete E-Mail</strong> (falls abweichend)',
        provide_2: '<strong>Ungef√§hres Zahlungsdatum</strong> (Tag/Monat/Jahr)',
        provide_3: '<strong>Zahlungsbetrag</strong> (1‚Ç¨, 9.99‚Ç¨ oder 19.99‚Ç¨)',
        provide_4: '<strong>Letzte 4 Ziffern der Karte</strong>, die verwendet wurde',
        provide_5: '<strong>Name des Karteninhabers</strong> (optional)',
        attach_title: 'üí° Sie k√∂nnen auch anh√§ngen:',
        attach_1: 'Screenshot der Stripe-Quittung',
        attach_2: 'E-Mail zur Zahlungsbest√§tigung',
        attach_3: 'Kontoauszug (mit verdeckten sensiblen Daten)',
        fast: 'Mit diesen Informationen k√∂nnen wir Ihre Bestellung schnell finden und Ihre Anfrage bearbeiten.',
        note: '<strong>Hinweis:</strong> Wenn Sie von einer anderen E-Mail als der Ihres Kaufs geschrieben haben, ist es normal, dass wir Sie nicht finden k√∂nnen. Geben Sie einfach die richtige E-Mail an und wir helfen Ihnen.',
        signature: 'Mit freundlichen Gr√º√üen,<br><strong>MindMetric Team</strong>',
        footer: 'Antworten Sie auf diese E-Mail mit den angeforderten Informationen'
      },
      it: {
        subject: 'üîç Informazioni Aggiuntive Richieste - MindMetric',
        title: 'üîç Informazioni Aggiuntive Richieste',
        greeting: 'Ciao,',
        not_found: '‚ö†Ô∏è Non abbiamo trovato il tuo account con l\'email: ',
        help: 'Per elaborare la tua richiesta, dobbiamo verificare alcuni dettagli del tuo ordine.',
        provide_title: 'üìã Per favore rispondi a questa email fornendo:',
        provide_1: '<strong>Email utilizzata per il pagamento</strong> (se diversa)',
        provide_2: '<strong>Data approssimativa del pagamento</strong> (giorno/mese/anno)',
        provide_3: '<strong>Importo del pagamento</strong> (1‚Ç¨, 9.99‚Ç¨ o 19.99‚Ç¨)',
        provide_4: '<strong>Ultime 4 cifre della carta</strong> utilizzata',
        provide_5: '<strong>Nome del titolare</strong> della carta (opzionale)',
        attach_title: 'üí° Puoi anche allegare:',
        attach_1: 'Screenshot della ricevuta Stripe',
        attach_2: 'Email di conferma del pagamento',
        attach_3: 'Estratto conto bancario (nascondendo i dati sensibili)',
        fast: 'Con queste informazioni potremo localizzare il tuo ordine ed elaborare la tua richiesta rapidamente.',
        note: '<strong>Nota:</strong> Se hai scritto da un\'email diversa da quella del tuo acquisto, √® normale che non ti troviamo. Fornisci semplicemente l\'email corretta e ti aiuteremo.',
        signature: 'Cordiali saluti,<br><strong>Team MindMetric</strong>',
        footer: 'Rispondi a questa email con le informazioni richieste'
      },
      pt: {
        subject: 'üîç Informa√ß√µes Adicionais Necess√°rias - MindMetric',
        title: 'üîç Informa√ß√µes Adicionais Necess√°rias',
        greeting: 'Ol√°,',
        not_found: '‚ö†Ô∏è N√£o encontramos sua conta com o email: ',
        help: 'Para processar sua solicita√ß√£o, precisamos verificar alguns detalhes do seu pedido.',
        provide_title: 'üìã Por favor, responda a este email fornecendo:',
        provide_1: '<strong>Email usado para o pagamento</strong> (se diferente)',
        provide_2: '<strong>Data aproximada do pagamento</strong> (dia/m√™s/ano)',
        provide_3: '<strong>Valor do pagamento</strong> (1‚Ç¨, 9.99‚Ç¨ ou 19.99‚Ç¨)',
        provide_4: '<strong>√öltimos 4 d√≠gitos do cart√£o</strong> usado',
        provide_5: '<strong>Nome do titular</strong> do cart√£o (opcional)',
        attach_title: 'üí° Voc√™ tamb√©m pode anexar:',
        attach_1: 'Captura de tela do recibo Stripe',
        attach_2: 'Email de confirma√ß√£o de pagamento',
        attach_3: 'Extrato banc√°rio (ocultando dados sens√≠veis)',
        fast: 'Com essas informa√ß√µes poderemos localizar seu pedido e processar sua solicita√ß√£o rapidamente.',
        note: '<strong>Nota:</strong> Se voc√™ escreveu de um email diferente do da sua compra, √© normal que n√£o o encontremos. Simplesmente forne√ßa o email correto e n√≥s o ajudaremos.',
        signature: 'Atenciosamente,<br><strong>Equipe MindMetric</strong>',
        footer: 'Responda a este email com as informa√ß√µes solicitadas'
      }
    }
  };
  
  // Retornar la plantilla en el idioma solicitado
  if (templates[tipo] && templates[tipo][lang]) {
    return templates[tipo][lang];
  }
  
  // Fallback a ingl√©s si no existe el tipo o idioma
  return templates[tipo] ? templates[tipo]['en'] : null;
}

// ============================================
// FUNCI√ìN PRINCIPAL PARA USAR EN N8N
// ============================================
// Ejemplo de uso en n8n:
// const idioma = $input.item.json.idioma || 'en';
// const plantilla = getEmailTemplate('reembolso_aprobado', idioma, $input.item.json);
// return { ...plantilla, ...datos_adicionales };

